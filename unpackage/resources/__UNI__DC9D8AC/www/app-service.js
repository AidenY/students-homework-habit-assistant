if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((s=>t.resolve(e()).then((()=>s))),(s=>t.resolve(e()).then((()=>{throw s}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";const t="/static/logo.png",s=(e,t)=>{const s=e.__vccOpts||e;for(const[o,r]of t)s[o]=r;return s};const o=s({methods:{goStart(){uni.navigateTo({url:"/pages/session/start"})},goHistory(){uni.navigateTo({url:"/pages/history/list"})}}},[["render",function(s,o,r,a,n,i){return e.openBlock(),e.createElementBlock("view",{class:"home-page"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"title-wrap"},[e.createElementVNode("text",{class:"app-title"},"ä½œä¸šä¹ æƒ¯å°åŠ©æ‰‹"),e.createElementVNode("text",{class:"app-subtitle"},"å¸®å­©å­å…»æˆä¸“æ³¨ã€å¥åº·çš„å†™ä½œä¸šä¹ æƒ¯")]),e.createElementVNode("image",{class:"header-logo",src:t,mode:"aspectFit"})]),e.createElementVNode("view",{class:"card main-card","hover-class":"card-hover","hover-stay-time":"80",onClick:o[0]||(o[0]=(...e)=>i.goStart&&i.goStart(...e))},[e.createElementVNode("view",{class:"card-left"},[e.createElementVNode("text",{class:"card-title"},"å¼€å§‹å†™ä½œä¸š"),e.createElementVNode("text",{class:"card-desc"},"å¼€å¯æœ¬æ¬¡ä½œä¸šä»»åŠ¡ï¼Œå®æ—¶å…³æ³¨åå§¿ä¸ä¸“æ³¨åŠ›")]),e.createElementVNode("view",{class:"card-right"},[e.createElementVNode("text",{class:"card-icon"},"â–¶")])]),e.createElementVNode("view",{class:"card secondary-card","hover-class":"card-hover","hover-stay-time":"80",onClick:o[1]||(o[1]=(...e)=>i.goHistory&&i.goHistory(...e))},[e.createElementVNode("view",{class:"card-left"},[e.createElementVNode("text",{class:"card-title"},"å†å²è®°å½•"),e.createElementVNode("text",{class:"card-desc"},"æŸ¥çœ‹æ¯ä¸€æ¬¡ä½œä¸šè¡¨ç°å’Œè¿›æ­¥è½¨è¿¹")]),e.createElementVNode("view",{class:"card-right small"},[e.createElementVNode("text",{class:"card-icon"},"ğŸ“˜")])])])}]]);const r=s({data:()=>({durationOptions:[30,45,60],selectedDuration:30}),methods:{selectDuration(e){this.selectedDuration=e},startSession(){const e=Date.now(),t=60*this.selectedDuration*1e3;uni.navigateTo({url:"/pages/session/doing?startTime="+e+"&expectedDuration="+t})}}},[["render",function(s,o,r,a,n,i){return e.openBlock(),e.createElementBlock("view",{class:"page start-page"},[e.createElementVNode("view",{class:"hero"},[e.createElementVNode("image",{class:"hero-image",src:t,mode:"aspectFit"}),e.createElementVNode("view",{class:"hero-text"},[e.createElementVNode("text",{class:"hero-title"},"å‡†å¤‡å¥½ä¸€èµ·å†™ä½œä¸šäº†å—ï¼Ÿ"),e.createElementVNode("text",{class:"hero-subtitle"},"é€‰ä¸€ä¸ªåˆé€‚çš„æ—¶é—´ï¼Œä¸“å¿ƒå®Œæˆæœ¬æ¬¡å°ä»»åŠ¡ï½")])]),e.createElementVNode("view",{class:"card"},[e.createElementVNode("view",{class:"card-title"},"é¢„è®¡ä¸“æ³¨æ—¶é•¿"),e.createElementVNode("view",{class:"duration-options"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.durationOptions,(t=>(e.openBlock(),e.createElementBlock("view",{key:t,class:e.normalizeClass(["duration-item",{active:t===n.selectedDuration}]),onClick:e=>i.selectDuration(t)},[e.createElementVNode("text",{class:"duration-value"},e.toDisplayString(t)+" åˆ†é’Ÿ",1)],10,["onClick"])))),128))])]),e.createElementVNode("view",{class:"card tips-card"},[e.createElementVNode("view",{class:"card-title"},"å°è´´å£«"),e.createElementVNode("text",{class:"tips-text"},"ä¿æŒåå§¿ç«¯æ­£ï¼Œå‡†å¤‡å¥½æ–‡å…·ï¼Œå…³æ‰ä¼šæ‰“æ‰°ä½ çš„è®¾å¤‡ï¼Œæˆ‘ä»¬ä¸€èµ·åŠ æ²¹ï¼")]),e.createElementVNode("view",{class:"bottom-area"},[e.createElementVNode("button",{class:"primary-btn",type:"primary","hover-class":"primary-btn-hover","hover-stay-time":"80",onClick:o[0]||(o[0]=(...e)=>i.startSession&&i.startSession(...e))}," å¼€å§‹å†™ä½œä¸š ")])])}]]);function a(e,t,...s){uni.__log__?uni.__log__(e,t,...s):console[e].apply(console,[...s,t])}const n="homework_sessions";function i(){try{return function(e){if(!e)return[];if(Array.isArray(e))return e;try{return JSON.parse(e)}catch(t){return a("warn","at common/storageService.js:9","parse storage error",t),[]}}(uni.getStorageSync(n))}catch(e){return a("warn","at common/storageService.js:19","getAllSessions error",e),[]}}function c(e){if(!e||e<=0)return"00:00";const t=Math.floor(e/1e3),s=Math.floor(t/3600),o=Math.floor(t%3600/60),r=t%60,a=e=>e<10?"0"+e:""+e;return s>0?`${a(s)}:${a(o)}:${a(r)}`:`${a(o)}:${a(r)}`}function l(e){if(!e)return"";const t=new Date(e),s=t.getFullYear(),o=t.getMonth()+1,r=t.getDate(),a=t.getHours(),n=t.getMinutes(),i=e=>e<10?"0"+e:""+e;return`${s}-${i(o)}-${i(r)} ${i(a)}:${i(n)}`}function u({startTime:e,endTime:t,snapshots:s,reminders:o}){const r=function(e,t){return e&&t?Math.max(0,t-e):0}(e,t),a=s.length||1;let n=0,i=0,c=0;s.forEach((e=>{"focus"===e.focusState?n+=1:c+=1,"good"===e.postureState&&(i+=1)}));const l=i/a;return{startTime:e,endTime:t,duration:r,focusDuration:r*(n/a),distractCount:c,reminderCount:o.length,postureGoodRatio:l}}function d({startTime:e,endTime:t,expectedDuration:s,snapshots:o=[],reminders:r=[]}){const a=u({startTime:e,endTime:t,snapshots:o,reminders:r});a.expectedDuration=s;const n=function(e){const t=e=>Math.round(60+40*Math.max(0,Math.min(1,e))),s=t(e.focusDuration/(e.duration||1)),o=t(e.postureGoodRatio),r=e.expectedDuration||e.duration||1,a=e.duration/r;let n=80;return a>1.2&&(n=70),a>1.5&&(n=60),a<.8&&(n=75),{focus:s,posture:o,efficiency:n,overall:Math.round(.4*s+.3*o+.3*n)}}({...a,expectedDuration:s}),i=function(e,t){const s=[];e.overall>=90?s.push("æœ¬æ¬¡ä½œä¸šè¡¨ç°éå¸¸æ£’ï¼Œä¿æŒäº†å¾ˆå¥½çš„ä¸“æ³¨å’Œä¹ æƒ¯ï¼"):e.overall>=75?s.push("æ•´ä½“è¡¨ç°ä¸é”™ï¼Œåªè¦å†ç»†å¿ƒä¸€ç‚¹ï¼Œä¼šæ›´ä¸Šä¸€å±‚æ¥¼ã€‚"):e.overall>=60?s.push("å·²ç»åœ¨æ…¢æ…¢è¿›æ­¥å•¦ï¼Œå†å¤šä¸€ç‚¹ä¸“æ³¨å’Œè€å¿ƒä¼šæ›´å¥½ã€‚"):s.push("è¿™æ¬¡çŠ¶æ€ä¸€èˆ¬ï¼Œåˆ«æ³„æ°”ï¼Œæˆ‘ä»¬ä¸‹æ¬¡ä¸€èµ·è°ƒæ•´èŠ‚å¥ã€‚");e.focus<75&&s.push("å¯ä»¥å°è¯•å…³æ‰ä¼šåˆ†å¿ƒçš„ä¸œè¥¿ï¼Œç¼©çŸ­ä¸€æ¬¡å­¦ä¹ æ—¶é—´å†æ…¢æ…¢å»¶é•¿ã€‚");e.posture<75&&s.push("æ³¨æ„åç›´èº«ä½“ï¼Œçœ¼ç›å’Œä¹¦æœ¬ä¿æŒåˆé€‚è·ç¦»ï¼Œä¿æŠ¤è§†åŠ›å’Œè„ŠæŸ±ã€‚");t.reminderCount>3&&s.push("æé†’æ¬¡æ•°æœ‰ç‚¹å¤šï¼Œä¸‹æ¬¡è¯•ç€åœ¨æé†’å‰è‡ªå·±å…ˆå‘ç°é—®é¢˜å¹¶è°ƒæ•´ã€‚");return s.join(" ")}(n,a);return function(e){const t=Date.now();return{id:e.id||String(t),startTime:e.startTime||t,endTime:e.endTime||t,expectedDuration:e.expectedDuration||0,duration:e.duration||0,focusDuration:e.focusDuration||0,distractCount:e.distractCount||0,reminderCount:e.reminderCount||0,postureGoodRatio:"number"==typeof e.postureGoodRatio?e.postureGoodRatio:0,scores:e.scores||{focus:0,posture:0,efficiency:0,overall:0},notesSummary:e.notesSummary||"",snapshots:e.snapshots||[]}}({id:String(e),startTime:e,endTime:t,expectedDuration:s,duration:a.duration,focusDuration:a.focusDuration,distractCount:a.distractCount,reminderCount:a.reminderCount,postureGoodRatio:a.postureGoodRatio,scores:n,notesSummary:i,snapshots:o})}const m=s({data:()=>({session:null}),computed:{durationText(){return this.session?c(this.session.duration):""},focusDurationText(){return this.session?c(this.session.focusDuration):""},summaryTitle(){if(!this.session)return"";const e=this.session.scores.overall;return e>=90?"è¡¨ç°éå¸¸æ£’ï¼Œç»§ç»­ä¿æŒï¼":e>=75?"æ•´ä½“ä¸é”™ï¼Œè¿˜æœ‰æå‡ç©ºé—´ï½":e>=60?"å·²ç»åœ¨è¿›æ­¥å•¦ï¼Œå†å¤šä¸€ç‚¹ä¸“æ³¨ä¼šæ›´å¥½ã€‚":"åˆ«ç°å¿ƒï¼Œä¸‹æ¬¡æ³¨æ„åå§¿å’Œä¸“æ³¨åº¦ï¼Œæˆ‘ä»¬ä¸€èµ·è¿›æ­¥ï¼"}},onLoad(e){const t=this.getOpenerEventChannel&&this.getOpenerEventChannel();if(t&&t.on&&t.on("sessionFinished",(e=>{const t=d(e);!function(e){const t=i();t.push(e);try{uni.setStorageSync(n,t)}catch(s){a("warn","at common/storageService.js:35","addSession error",s)}}(t),this.session=t})),e&&e.sessionId){const t=(s=e.sessionId,i().find((e=>e.id===s)));t&&(this.session=t)}var s},methods:{goHome(){uni.switchTab({url:"/pages/index/index",fail:()=>{uni.reLaunch({url:"/pages/index/index"})}})},goHistory(){uni.navigateTo({url:"/pages/history/list"})}}},[["render",function(t,s,o,r,a,n){return a.session?(e.openBlock(),e.createElementBlock("view",{key:0,class:"page report-page"},[e.createElementVNode("view",{class:"score-card"},[e.createElementVNode("view",{class:"score-circle"},[e.createElementVNode("text",{class:"score-value"},e.toDisplayString(a.session.scores.overall),1)]),e.createElementVNode("view",{class:"score-text"},[e.createElementVNode("text",{class:"score-title"},"æœ¬æ¬¡ä½œä¸šç»¼åˆè¯„åˆ†"),e.createElementVNode("text",{class:"score-subtitle"},e.toDisplayString(n.summaryTitle),1)])]),e.createElementVNode("view",{class:"card sub-score-card"},[e.createElementVNode("view",{class:"sub-score-item"},[e.createElementVNode("text",{class:"sub-score-label"},"ä¸“æ³¨"),e.createElementVNode("text",{class:"sub-score-value"},e.toDisplayString(a.session.scores.focus),1)]),e.createElementVNode("view",{class:"sub-score-item"},[e.createElementVNode("text",{class:"sub-score-label"},"åå§¿ä¸ä¹ æƒ¯"),e.createElementVNode("text",{class:"sub-score-value"},e.toDisplayString(a.session.scores.posture),1)]),e.createElementVNode("view",{class:"sub-score-item"},[e.createElementVNode("text",{class:"sub-score-label"},"æ•ˆç‡"),e.createElementVNode("text",{class:"sub-score-value"},e.toDisplayString(a.session.scores.efficiency),1)])]),e.createElementVNode("view",{class:"card stats-card"},[e.createElementVNode("view",{class:"stats-row"},[e.createElementVNode("view",{class:"stats-item"},[e.createElementVNode("text",{class:"stats-label"},"æ€»æ—¶é•¿"),e.createElementVNode("text",{class:"stats-value"},e.toDisplayString(n.durationText),1)]),e.createElementVNode("view",{class:"stats-item"},[e.createElementVNode("text",{class:"stats-label"},"ä¸“æ³¨æ—¶é•¿"),e.createElementVNode("text",{class:"stats-value"},e.toDisplayString(n.focusDurationText),1)])]),e.createElementVNode("view",{class:"stats-row"},[e.createElementVNode("view",{class:"stats-item"},[e.createElementVNode("text",{class:"stats-label"},"èµ°ç¥æ¬¡æ•°"),e.createElementVNode("text",{class:"stats-value"},e.toDisplayString(a.session.distractCount),1)]),e.createElementVNode("view",{class:"stats-item"},[e.createElementVNode("text",{class:"stats-label"},"æé†’æ¬¡æ•°"),e.createElementVNode("text",{class:"stats-value"},e.toDisplayString(a.session.reminderCount),1)])])]),e.createElementVNode("view",{class:"card summary-card"},[e.createElementVNode("text",{class:"summary-title"},"è€å¸ˆçš„è¯"),e.createElementVNode("text",{class:"summary-text"},e.toDisplayString(a.session.notesSummary),1)]),e.createElementVNode("view",{class:"bottom-area"},[e.createElementVNode("button",{class:"secondary-btn","hover-class":"secondary-btn-hover","hover-stay-time":"80",onClick:s[0]||(s[0]=(...e)=>n.goHistory&&n.goHistory(...e))}," æŸ¥çœ‹å†å²è®°å½• "),e.createElementVNode("button",{class:"primary-btn","hover-class":"primary-btn-hover","hover-stay-time":"80",onClick:s[1]||(s[1]=(...e)=>n.goHome&&n.goHome(...e))}," è¿”å›é¦–é¡µ ")])])):e.createCommentVNode("",!0)}]]);const p=s({data:()=>({sessions:[]}),onShow(){const e=(i()||[]).slice().sort(((e,t)=>t.startTime-e.startTime)).map((e=>({...e,dateText:l(e.startTime),durationText:c(e.duration)})));this.sessions=e},methods:{buildTag(e){const t=e.scores.overall;return t>=90?"çŠ¶æ€æä½³":t>=75?"è¡¨ç°ä¸é”™":t>=60?"è¿˜å¯ä»¥æå‡":"éœ€è¦å¤šå¤šåŠªåŠ›"},goDetail(e){uni.navigateTo({url:"/pages/session/report?sessionId="+e.id})}}},[["render",function(t,s,o,r,a,n){return e.openBlock(),e.createElementBlock("view",{class:"page history-page"},[0===a.sessions.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty"},[e.createElementVNode("text",{class:"empty-title"},"è¿˜æ²¡æœ‰ä½œä¸šè®°å½•"),e.createElementVNode("text",{class:"empty-subtitle"},"ä»é¦–é¡µå¼€å§‹ä¸€æ®µæ–°çš„ä¸“æ³¨æ—¶å…‰å§ï½")])):(e.openBlock(),e.createElementBlock("view",{key:1},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(a.sessions,(t=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"card session-item","hover-class":"card-hover","hover-stay-time":"80",onClick:e=>n.goDetail(t)},[e.createElementVNode("view",{class:"session-main"},[e.createElementVNode("text",{class:"session-date"},e.toDisplayString(t.dateText),1),e.createElementVNode("text",{class:"session-score"},e.toDisplayString(t.scores.overall)+" åˆ†",1)]),e.createElementVNode("view",{class:"session-sub"},[e.createElementVNode("text",{class:"session-duration"},"æ—¶é•¿ï¼š"+e.toDisplayString(t.durationText),1),e.createElementVNode("text",{class:"session-tag"},e.toDisplayString(n.buildTag(t)),1)])],8,["onClick"])))),128))]))])}]]);__definePage("pages/index/index",o),__definePage("pages/session/start",r),__definePage("pages/session/report",m),__definePage("pages/history/list",p);const g={onLaunch:function(){a("log","at App.vue:4","App Launch")},onShow:function(){a("log","at App.vue:7","App Show")},onHide:function(){a("log","at App.vue:10","App Hide")}};const{app:y,Vuex:v,Pinia:h}={app:e.createVueApp(g)};uni.Vuex=v,uni.Pinia=h,y.provide("__globalStyles",__uniConfig.styles),y._component.mpType="app",y._component.render=()=>{},y.mount("#app")}(Vue);
